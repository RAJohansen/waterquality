<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction to the waterquality package • waterquality</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to the waterquality package">
<meta property="og:description" content="waterquality">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">waterquality</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.3.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/waterquality_vignette.html">Introduction to the waterquality package</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/RAJohansen/waterquality/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Introduction to the waterquality package</h1>
                        <h4 data-toc-skip class="author">Richard
Johansen, Jakub Nowosad, Molly Reif, and Erich Emery</h4>
            
            <h4 data-toc-skip class="date">2023-07-17</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/RAJohansen/waterquality/blob/HEAD/../vignettes/waterquality_vignette.Rmd" class="external-link"><code>../vignettes/waterquality_vignette.Rmd</code></a></small>
      <div class="hidden name"><code>waterquality_vignette.Rmd</code></div>

    </div>

    
    
<p>The main purpose of <strong>waterquality</strong> is to quickly and
easily convert satellite-based reflectance imagery into one or many
well-known water quality indices designed for the detection of harmful
algal blooms (HABs) using the following pigment proxies: chlorophyll-a,
blue-green algae (phycocyanin), and turbidity. Currently, this package
is able to process <a href="https://rajohansen.github.io/waterquality/reference/index.html" class="external-link">40
algorithms</a> for the following satellite-based imagers: WorldView-2
and -3, Sentinel-2, Landsat-8, MODIS, MERIS, and OLCI. In order to
improve the aesthetics of the <code>wq_calc</code> output, a series of
intuitive <code>Map_WQ</code> functions were developed to help reduce
technical barriers due to coding and the myriad of map options.</p>
<p>Additional functionality of the package includes a series of
<code>extract_lm</code> functions which wrap the <a href="https://www.rdocumentation.org/packages/stats/versions/3.6.2/topics/lm" class="external-link">“Fitting
Linear Models”</a> and the <a href="http://topepo.github.io/caret/index.html" class="external-link">“caret”</a> packages to
quickly generate a suite of regression models with standardized outputs.
These functions range from simple linear models for a single dependent
and independent variable to robust linear regression using
crossvalidation over multiple dependent and independent variables. These
functions are extremely useful when conducting experimental testing on a
large number of satellite algorithms across multiple water quality
parameters. <strong>NOTE</strong> these functions require ground-truth
data in order to develop the models.</p>
<p>For an example of our entire research workflow, which includes data
acquisition, image pre-processing, analyses, and results please see our
publication entitled <a href="https://erdc-library.erdc.dren.mil/jspui/bitstream/11681/35053/3/ERDC-EL%20TR-19-20.pdf" class="external-link">“Waterquality:
An Open-Source R Package for the Detection and Quantification of
Cyanobacterial Harmful Algal Blooms and Water Quality”</a>.</p>
<div class="section level2">
<h2 id="algorithms">Algorithms<a class="anchor" aria-label="anchor" href="#algorithms"></a>
</h2>
<p>Currently, the package includes a total of <a href="https://rajohansen.github.io/waterquality/reference/index.html" class="external-link">40
algorithms</a> that can be applied for the detection of the three
parameters. <strong>NOTE</strong> not all sensors are capable of using
all algorithms due to their spectral configurations. Each of the
algorithms are searchable within the package, where there is a reference
to the original paper (Ex. <code>?Am092Bsub()</code>). Each algorithm is
also linked to the original papers water quality parameters
(chlorophyll-a, phycocyanin, turbidity) by type, which allows users to
select all algorithms for that type. The final outputs are raster
stacked images which represent relative index values and are not direct
estimations of chlorophyll-a, phycocyanin, or turbidity values. However,
relative index values can be converted to estimated concentration values
using the <code>extract_lm</code> functions and ground truth
measurements.</p>
</div>
<div class="section level2">
<h2 id="water-quality-functions">Water Quality Functions<a class="anchor" aria-label="anchor" href="#water-quality-functions"></a>
</h2>
<div class="section level3">
<h3 id="wq_calc">wq_calc()<a class="anchor" aria-label="anchor" href="#wq_calc"></a>
</h3>
<p>The main function of this package is called <code><a href="../reference/wq_calc.html">wq_calc()</a></code>
which calculates water quality indices by using a reflectance raster
stack as an input, user-defined algorithm(s) selection, and satellite
configuration selection corresponding to the following three arguments:
<code>terraRast</code>, <code>alg</code>, and <code>sat</code>.</p>
<ul>
<li>
<code>terraRast</code> - The input reflectance image to be used in
band algorithm calculation.</li>
<li>
<code>alg</code> - Determines the indices to be utilized:
<ul>
<li>Single Algorithm</li>
<li>Multiple Algorithm</li>
<li>Type of Algorithm</li>
<li>All Possible Algorithms</li>
</ul>
</li>
<li>
<code>sat</code> - Determines the appropriate spectral configuration
and subsequently appropriate algorithms to be calculated from predefined
list:
<ul>
<li>WorldView-2</li>
<li>Sentinel-2</li>
<li>Landsat-8</li>
<li>MODIS</li>
<li>MERIS</li>
<li>OLCI</li>
</ul>
</li>
</ul>
<div class="section level4">
<h4 id="single-algorithm">Single Algorithm<a class="anchor" aria-label="anchor" href="#single-algorithm"></a>
</h4>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/RAJohansen/waterquality" class="external-link">waterquality</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/" class="external-link">terra</a></span><span class="op">)</span></span>
<span><span class="va">Harsha</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"raster/S2_Harsha.tif"</span>, package <span class="op">=</span> <span class="st">"waterquality"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Harsha_Am092Bsub</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/wq_calc.html">wq_calc</a></span><span class="op">(</span>terraRast <span class="op">=</span> <span class="va">Harsha</span>, </span>
<span>                            alg <span class="op">=</span> <span class="st">"MM12NDCI"</span>, </span>
<span>                            sat <span class="op">=</span> <span class="st">"sentinel2"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">Harsha_Am092Bsub</span><span class="op">)</span></span></code></pre></div>
<p><img src="waterquality_vignette_files/figure-html/unnamed-chunk-3-1.png" width="576"></p>
</div>
<div class="section level4">
<h4 id="multiple-algorithms">Multiple Algorithms<a class="anchor" aria-label="anchor" href="#multiple-algorithms"></a>
</h4>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Harsha_Multiple</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/wq_calc.html">wq_calc</a></span><span class="op">(</span>terraRast <span class="op">=</span> <span class="va">Harsha</span>,</span>
<span>                           alg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"MM12NDCI"</span>, <span class="st">"Am092Bsub"</span>, <span class="st">"Da052BDA"</span><span class="op">)</span>, </span>
<span>                           sat <span class="op">=</span> <span class="st">"sentinel2"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">Harsha_Multiple</span><span class="op">)</span> </span></code></pre></div>
<p><img src="waterquality_vignette_files/figure-html/unnamed-chunk-5-1.png" width="576"></p>
</div>
<div class="section level4">
<h4 id="type-of-algorithm">Type of Algorithm<a class="anchor" aria-label="anchor" href="#type-of-algorithm"></a>
</h4>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Harsha_PC</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/wq_calc.html">wq_calc</a></span><span class="op">(</span><span class="va">Harsha</span>,</span>
<span>                     alg <span class="op">=</span> <span class="st">"chlorophyll"</span>, </span>
<span>                     sat <span class="op">=</span> <span class="st">"sentinel2"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">Harsha_PC</span><span class="op">)</span> </span></code></pre></div>
<p><img src="waterquality_vignette_files/figure-html/unnamed-chunk-7-1.png" width="576"></p>
</div>
<div class="section level4">
<h4 id="all-algorithms">All Algorithms<a class="anchor" aria-label="anchor" href="#all-algorithms"></a>
</h4>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Harsha_All</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/wq_calc.html">wq_calc</a></span><span class="op">(</span><span class="va">Harsha</span>, </span>
<span>                      alg <span class="op">=</span> <span class="st">"all"</span>,</span>
<span>                      sat <span class="op">=</span> <span class="st">"sentinel2"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">Harsha_All</span><span class="op">)</span> <span class="co"># Only displays first 16 of 28</span></span></code></pre></div>
<p><img src="waterquality_vignette_files/figure-html/unnamed-chunk-9-1.png" width="576"></p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="mapping-functions">Mapping Functions<a class="anchor" aria-label="anchor" href="#mapping-functions"></a>
</h2>
<div class="section level3">
<h3 id="map_wq_raster">Map_WQ_raster<a class="anchor" aria-label="anchor" href="#map_wq_raster"></a>
</h3>
<p>This function wraps the <a href="https://cran.r-project.org/package=tmap" class="external-link">“tmap”</a> package to
help users to efficiently generate a map of a raster image which can be
overlaid with optional geospatial objects and data histogram. In order
to simplify this process and reduce the technical expertise required,
the number of arguments were reduced to the following: -
<code>WQ_raster</code> - Raster file generated from <code>wq_calc</code>
or other GeoTiff file<br>
- <code>sample_points</code> - geospatial file (.shp or .gpkg)
containing sampling locations - <code>map_title</code> - text used to
generate title of map - <code>raster_style</code> - method to process
the color scale when col is a numeric variable. Please refer to the
style argument in the <code>?tmap::tm_raster()</code> function for more
details (Default is “quantile”). - <code>histogram</code> - Option to
add or remove a histogram of the data values. (Default is TRUE)</p>
<div class="section level4">
<h4 id="raster-with-points">Raster with points<a class="anchor" aria-label="anchor" href="#raster-with-points"></a>
</h4>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/RAJohansen/waterquality" class="external-link">waterquality</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/" class="external-link">terra</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-tmap/tmap" class="external-link">tmap</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="va">s2</span> <span class="op">=</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"raster/S2_Harsha.tif"</span>, package <span class="op">=</span> <span class="st">"waterquality"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">MM12NDCI</span> <span class="op">=</span> <span class="fu"><a href="../reference/wq_calc.html">wq_calc</a></span><span class="op">(</span><span class="va">s2</span>, alg <span class="op">=</span> <span class="st">"MM12NDCI"</span>, sat <span class="op">=</span> <span class="st">"sentinel2"</span><span class="op">)</span></span>
<span><span class="va">samples</span> <span class="op">=</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/vect.html" class="external-link">vect</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"raster/Harsha_Simple_Points_CRS.gpkg"</span>, package <span class="op">=</span> <span class="st">"waterquality"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">lake_extent</span> <span class="op">=</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/vect.html" class="external-link">vect</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"raster/Harsha_Lake_CRS.gpkg"</span>, package <span class="op">=</span> <span class="st">"waterquality"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/Map_WQ_raster.html">Map_WQ_raster</a></span><span class="op">(</span>WQ_raster <span class="op">=</span> <span class="va">MM12NDCI</span>,</span>
<span>              sample_points <span class="op">=</span> <span class="va">samples</span>,</span>
<span>              map_title<span class="op">=</span> <span class="st">"Water Quality Map"</span>,</span>
<span>              raster_style <span class="op">=</span> <span class="st">"quantile"</span>,</span>
<span>              histogram <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="waterquality_vignette_files/figure-html/unnamed-chunk-11-1.png" width="576"></p>
</div>
</div>
<div class="section level3">
<h3 id="map_wq_basemap">Map_WQ_basemap<a class="anchor" aria-label="anchor" href="#map_wq_basemap"></a>
</h3>
<p>This function wraps the <a href="https://cran.r-project.org/package=tmap" class="external-link">“tmap”</a> &amp; <a href="https://cran.r-project.org/package=tmaptools" class="external-link">“tmaptools”</a>
packages in order to generate a map using user-defined vectors (points
and a polygon) overlaid on a Bing basemap. In order to simplify this
process and reduce the technical expertise required, the number of
arguments were reduced to the following: - <code>WQ_extent</code> -
geospatial file (.shp or .gpkg) used to extract aerial imagery from Bing
basemaps<br>
- <code>WQ_parameter</code> - text referring to column heading of data
being mapped (i.e. Chl-a, PC, etc.) - <code>sample_points</code> -
geospatial file (.shp or .gpkg) containing sampling locations -
<code>map_title</code> - text used to generate title of map -
<code>raster_style</code> - method to process the color scale when col
is a numeric variable. Please refer to the style argument in the
<code>?tmap::tm_raster()</code> function for more details (Default is
“quantile”). - <code>histogram</code> - Option to add or remove a
histogram of the data values. (Default = TRUE)</p>
<div class="section level4">
<h4 id="basemap-with-points">Basemap with points<a class="anchor" aria-label="anchor" href="#basemap-with-points"></a>
</h4>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/Map_WQ_basemap.html">Map_WQ_basemap</a></span><span class="op">(</span>WQ_extent <span class="op">=</span> <span class="va">lake_extent</span>,</span>
<span>              sample_points <span class="op">=</span> <span class="va">samples</span>,</span>
<span>              WQ_parameter <span class="op">=</span> <span class="st">"Chl_ugL"</span>,</span>
<span>              map_title<span class="op">=</span> <span class="st">"Water Quality Map"</span>,</span>
<span>              points_style <span class="op">=</span> <span class="st">"quantile"</span>,</span>
<span>              histogram <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="modeling-functions">Modeling Functions<a class="anchor" aria-label="anchor" href="#modeling-functions"></a>
</h2>
<p>Developing models is an essential step in water quality monitoring,
and this requires sufficient coincident ground truth data. These
functions have been developed to combine user-provided ground truth data
and the results from the <code>wq_calc</code> function to generate a
single or series of regression models. These functions have been
developed to easily conduct linear models with standardized outputs,
providing intuitive yet robust options. Most effectively, the functions
will utilize a single comma delimited (.csv) file as the data frame
source. Although these functions were designed for our water quality
research, they can be used as standalone functions for any data to
generate the same standardized outputs containing the following:<br><strong>Global Model</strong><br>
- r<sup>2</sup><br>
- p-value<br>
- slope<br>
- intercept</p>
<p><strong>Crossvalidated Model</strong><br>
- average r<sup>2</sup><br>
- average RMSE<br>
- average MAE</p>
<p>Additionally, we have provided code that might be useful to help
users import and extract the data from a raster stack image (i.e. output
from <code>wq_calc</code>), combine it with a geospatial object (i.e
shapefiles of sample locations), and export the results to a .csv file
to be used in the modeling functions.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Input raster image</span></span>
<span><span class="va">wq_raster</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="st">"C:/temp/my_raster.tif"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Input shapefile</span></span>
<span><span class="va">wq_samples</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/vect.html" class="external-link">vect</a></span><span class="op">(</span><span class="st">'C:/temp/my_samples.shp'</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Extract values from raster and combine with shapefile</span></span>
<span><span class="va">waterquality_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">wq_samples</span>, <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/extract.html" class="external-link">extract</a></span><span class="op">(</span><span class="va">wq_raster</span>, <span class="va">wq_samples</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Export results as csv file</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span><span class="va">waterquality_data</span>, file <span class="op">=</span> <span class="st">"C:/temp/waterquality_data.csv"</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="extract_lm">extract_lm<a class="anchor" aria-label="anchor" href="#extract_lm"></a>
</h3>
<ul>
<li>
<code>parameter</code> A string specifying water quality
parameter</li>
<li>
<code>algorithm</code> A string specifying water quality
algorithm</li>
<li>
<code>df</code> data frame containing the values for parameter and
algorithm arguments</li>
</ul>
<div class="section level4">
<h4 id="example">Example<a class="anchor" aria-label="anchor" href="#example"></a>
</h4>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/RAJohansen/waterquality" class="external-link">waterquality</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/topepo/caret/" class="external-link">caret</a></span><span class="op">)</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"raster/waterquality_data.csv"</span>, package <span class="op">=</span> <span class="st">"waterquality"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/extract_lm.html">extract_lm</a></span><span class="op">(</span>parameter <span class="op">=</span> <span class="st">"Chl_ugL"</span>, algorithm <span class="op">=</span> <span class="st">"MM12NDCI"</span>, df <span class="op">=</span> <span class="va">df</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 4</span></span></span>
<span><span class="co">#&gt;   R_Squared Slope Intercept P_Value</span></span>
<span><span class="co">#&gt;       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     0.162  26.2      4.69   0.153</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="extract_lm_cv">extract_lm_cv<a class="anchor" aria-label="anchor" href="#extract_lm_cv"></a>
</h3>
<ul>
<li>
<code>parameter</code> A string specifying water quality
parameter</li>
<li>
<code>algorithm</code> A string specifying water quality
algorithm</li>
<li>
<code>df</code> data frame containing the values for parameter and
algorithm arguments</li>
<li>
<code>train_method</code> A string specifying which classification
or regression model to use (Default = “lm”). See ?caret::train for more
details</li>
<li>
<code>control_method</code> A string specifying the resampling
method (Default = “repeatedcv”). See ?caret::trainControl for more
details</li>
<li>
<code>folds</code> the number of folds to be used in the cross
validation model (Default = 3)</li>
<li>
<code>nrepeats</code> the number of iterations to be used in the
cross validation model (Default = 5)</li>
</ul>
<div class="section level4">
<h4 id="example-1">Example<a class="anchor" aria-label="anchor" href="#example-1"></a>
</h4>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/extract_lm_cv.html">extract_lm_cv</a></span><span class="op">(</span>parameter <span class="op">=</span> <span class="st">"Chl_ugL"</span>, algorithm <span class="op">=</span> <span class="st">"MM12NDCI"</span>,</span>
<span>                                       df <span class="op">=</span> <span class="va">df</span>, train_method <span class="op">=</span> <span class="st">"lm"</span>, control_method <span class="op">=</span> <span class="st">"repeatedcv"</span>,</span>
<span>                                       folds <span class="op">=</span> <span class="fl">3</span>, nrepeats <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 7</span></span></span>
<span><span class="co">#&gt;   R_Squared Slope Intercept P_Value CV_R_Squared  RMSE   MAE</span></span>
<span><span class="co">#&gt;       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     0.162  26.2      4.69   0.153        0.358  1.99  1.38</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="extract_lm_cv_multi">extract_lm_cv_multi<a class="anchor" aria-label="anchor" href="#extract_lm_cv_multi"></a>
</h3>
<ul>
<li>
<code>parameters</code> list of water quality parameters</li>
<li>
<code>algorithms</code> list of water quality algorithms</li>
<li>
<code>df</code> data frame containing the values for parameter and
algorithm arguments</li>
<li>
<code>train_method</code> A string specifying which classification
or regression model to use (Default = “lm”). See ?caret::train for more
details</li>
<li>
<code>control_method</code> A string specifying the resampling
method (Default = “repeatedcv”). See ?caret::trainControl for more
details</li>
<li>
<code>folds</code> the number of folds to be used in the cross
validation model (Default = 3)</li>
<li>
<code>nrepeats</code> the number of iterations to be used in the
cross validation model (Default = 5)</li>
</ul>
<div class="section level4">
<h4 id="example-2">Example<a class="anchor" aria-label="anchor" href="#example-2"></a>
</h4>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create series of strings to be used for parameters and algorithms arguments</span></span>
<span><span class="va">algorithms</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">df</span><span class="op">[</span><span class="fl">6</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">parameters</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">df</span><span class="op">[</span><span class="fl">3</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">extract_lm_cv_multi_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extract_lm_cv_multi.html">extract_lm_cv_multi</a></span><span class="op">(</span>parameters <span class="op">=</span> <span class="va">parameters</span>, algorithms <span class="op">=</span> <span class="va">algorithms</span>,</span>
<span>                                                   df <span class="op">=</span> <span class="va">df</span>, train_method <span class="op">=</span> <span class="st">"lm"</span>, control_method <span class="op">=</span> <span class="st">"repeatedcv"</span>,</span>
<span>                                                   folds <span class="op">=</span> <span class="fl">3</span>, nrepeats <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="va">extract_lm_cv_multi_results</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 8</span></span></span>
<span><span class="co">#&gt;   Algorithms       R_Squared    Slope Intercept P_Value CV_R_Squared  RMSE   MAE</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Turbid_NTU_Al10…     0.441 -<span style="color: #BB0000;">30.5</span>      -<span style="color: #BB0000;">4.37</span>   9.54<span style="color: #949494;">e</span><span style="color: #BB0000;">-3</span>        0.511  2.78  1.79</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Turbid_NTU_Go04…     0.763   0.043<span style="text-decoration: underline;">0</span>    0.311  4.46<span style="color: #949494;">e</span><span style="color: #BB0000;">-5</span>        0.435  2.23  1.46</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> Turbid_NTU_Ku15…     0.432   0.081<span style="text-decoration: underline;">8</span>   -<span style="color: #BB0000;">0.068</span><span style="color: #BB0000; text-decoration: underline;">7</span> 1.06<span style="color: #949494;">e</span><span style="color: #BB0000;">-2</span>        0.371  2.86  1.91</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> Turbid_NTU_MM12…     0.166  42.3       0.370  1.48<span style="color: #949494;">e</span><span style="color: #BB0000;">-1</span>        0.428  2.64  1.71</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> Turbid_NTU_Wy08…     0.432   0.081<span style="text-decoration: underline;">8</span>   -<span style="color: #BB0000;">0.068</span><span style="color: #BB0000; text-decoration: underline;">7</span> 1.06<span style="color: #949494;">e</span><span style="color: #BB0000;">-2</span>        0.573  3.01  1.96</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> Chl_ugL_Al10SABI     0.534 -<span style="color: #BB0000;">21.0</span>       1.30   2.99<span style="color: #949494;">e</span><span style="color: #BB0000;">-3</span>        0.685  1.41  1.13</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="extract_lm_cv_all">extract_lm_cv_all<a class="anchor" aria-label="anchor" href="#extract_lm_cv_all"></a>
</h3>
<ul>
<li>
<code>parameters</code> list of water quality parameters</li>
<li>
<code>df</code> data frame containing the values for parameter and
algorithm arguments</li>
<li>
<code>train_method</code> A string specifying which classification
or regression model to use (Default = “lm”). See ?caret::train for more
details</li>
<li>
<code>control_method</code> A string specifying the resampling
method (Default = “repeatedcv”). See ?caret::trainControl for more
details</li>
<li>
<code>folds</code> the number of folds to be used in the cross
validation model (Default = 3)</li>
<li>
<code>nrepeats</code> the number of iterations to be used in the
cross validation model (Default = 5)</li>
</ul>
<div class="section level4">
<h4 id="example-3">Example<a class="anchor" aria-label="anchor" href="#example-3"></a>
</h4>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">extract_lm_cv_all_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extract_lm_cv_all.html">extract_lm_cv_all</a></span><span class="op">(</span>parameters <span class="op">=</span> <span class="va">parameters</span>, df <span class="op">=</span> <span class="va">df</span>,</span>
<span>                                                 train_method <span class="op">=</span> <span class="st">"lm"</span>, control_method <span class="op">=</span> <span class="st">"repeatedcv"</span>,</span>
<span>                                                 folds <span class="op">=</span> <span class="fl">3</span>, nrepeats <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="va">extract_lm_cv_all_results</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 8</span></span></span>
<span><span class="co">#&gt;   Algorithms        R_Squared  Slope Intercept  P_Value CV_R_Squared  RMSE   MAE</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                 <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Turbid_NTU_pH         0.976 -<span style="color: #BB0000;">14.1</span>    125.    4.86<span style="color: #949494;">e</span><span style="color: #BB0000;">-11</span>        0.620  1.47 0.820</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Turbid_NTU_Al10S…     0.441 -<span style="color: #BB0000;">30.5</span>     -<span style="color: #BB0000;">4.37</span>  9.54<span style="color: #949494;">e</span><span style="color: #BB0000;">- 3</span>        0.549  2.42 1.46 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> Turbid_NTU_MM12N…     0.166  42.3      0.370 1.48<span style="color: #949494;">e</span><span style="color: #BB0000;">- 1</span>        0.411  2.81 1.82 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> Turbid_NTU_Da052…     0.168  19.2    -<span style="color: #BB0000;">18.7</span>   1.45<span style="color: #949494;">e</span><span style="color: #BB0000;">- 1</span>        0.260  2.61 1.65 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> Turbid_NTU_MM12N…     0.166  42.3      0.370 1.48<span style="color: #949494;">e</span><span style="color: #BB0000;">- 1</span>        0.432  2.96 2.00 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> Turbid_NTU_TurbD…     0.136  -<span style="color: #BB0000;">7.44</span>     5.47  1.95<span style="color: #949494;">e</span><span style="color: #BB0000;">- 1</span>        0.380  2.82 1.93</span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="acknowledgements">Acknowledgements<a class="anchor" aria-label="anchor" href="#acknowledgements"></a>
</h2>
<p>The waterquality package was developed with funding from the U.S.
Army Corps of Engineers. The authors would also like to thank the
University of Cincinnati Library’s Research &amp; Data Services and the
University of Cincinnati’s Space Informatics Lab for their expertise and
technical services.</p>
</div>
<div class="section level2">
<h2 id="credit">Credit<a class="anchor" aria-label="anchor" href="#credit"></a>
</h2>
<p>To cite this library, please use the following entry:</p>
<p>Johansen R., Reif M., Emery E., Nowosad J., Beck R., Xu M., Liu H.,
waterquality: An Open-Source R Package for the Detection and
Quantification of Cyanobacterial Harmful Algal Blooms and Water Quality.
USACE ERDC/EL TR-19-20; DOI: 10.21079/11681/35053</p>
<p><span class="citation">@Article</span>{, author = {Richard Johansen
and Molly Reif and Erich Emery and Jakub Nowosad and Richard Beck and
Min Xu and Hongxing Liu}, title = {waterquality: An Open-Source R
Package for the Detection and Quantification of Cyanobacterial Harmful
Algal Blooms and Water Quality}, year = {2019}, doi =
{10.21079/11681/35053}, journal = {USACE ERDC/EL TR-19-20}, }</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Richard Johansen, Jakub Nowosad, Molly Reif, Erich Emery, U.S. Army Corps of Engineers.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
